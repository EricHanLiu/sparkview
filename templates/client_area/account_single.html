<!DOCTYPE html>
{% extends 'main.html' %}
{% load staticfiles %}

{% load template_filters %}

{% block leftAside %}
{% endblock %}

{% block extraCss %}
    <style>
        .m-card-profile {
            display: inline-block;
            float: left;
            width: 200px;
            padding: 5px 15px;
            margin: 0;
        }

        .m-card-profile__pic-wrapper img {
            max-height: 80px;
        }

        {% if not account.star_flag %}
            .fa-flag:hover {
                cursor: pointer;
            }
        {% endif %}
    </style>
{% endblock %}

{% block content %}
    <div class="m-content">
        <!-- Assigned members -->
        <div class="row">
            <div class="col-xl-12">
                {% if account.has_blacklisted_accounts %}
                    <div class="alert alert-danger alert-dismissible fade show" role="alert">
                        <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                        </button>
                        <strong>Warning!</strong> One or more of the ad accounts associated with this account are
                        blacklisted. They are not retrieving any new spend information.
                    </div>
                {% endif %}
                {% if account.status == 2 %}
                    <div class="alert alert-warning alert-dismissible fade show" role="alert">
                        <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                        </button>
                        <strong>Heads Up!</strong> This account is inactive. The reason
                        is {{ account.get_inactive_reason_display }}. {% if account.inactive_return_date != None %}It is
                        supposed to return on {{ account.inactive_return_date|just_date }}{% endif %}
                    </div>
                {% endif %}
                {% if account.status == 3 %}
                    <div class="alert alert-danger alert-dismissible fade show" role="alert">
                        <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                        </button>
                        <strong>Warning!</strong> This account is lost. The reason
                        is {{ account.get_lost_reason_display }}.
                    </div>
                {% endif %}
                {% if account.has_blacklisted_accounts %}
                    <div class="alert alert-danger alert-dismissible fade show" role="alert">
                        <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                        </button>
                        <strong>Warning!</strong> One or more of the ad accounts associated with this account are
                        blacklisted. They are not retrieving any new spend information.
                    </div>
                {% endif %}
                {% if account.status == 0 %}
                    <div class="alert alert-info alert-dismissible fade show" role="alert">
                        <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                        </button>
                        <strong>Notice:</strong> This account is in the onboarding phase. Go <a
                            href="/clients/accounts/onboard/{{ account.id }}" style="color:#fff;">here</a> to view the
                        progress.
                    </div>
                    {% if account.is_late_to_onboard %}
                        <div class="alert alert-danger alert-dismissible fade show" role="alert">
                        <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                        </button>
                        <strong>Warning!</strong> This account is late to onboard.
                            It has been in the onboarding phase for {{ account.onboarding_duration_elapsed }} days.
                            {% if account.late_onboard_reason != None and account.late_onboard_reason != '' %}
                                The reason is {{ account.late_onboard_reason }}.
                            {% endif %}
                    </div>
                    {% endif %}
                {% endif %}
                <div class="m-portlet m-portlet--mobile m-portlet--body-progress-">
                    <div class="m-portlet__head">
                        <div class="m-portlet__head-caption">
                            <div class="m-portlet__head-title">
                                <h3 class="m-portlet__head-text" style="font-size: 1.3rem;">
                                    {{ account.client_name }} Team
                                    &nbsp;
                                    <span class="m-badge m-badge--{{ status_badges|get_item_from_list:account.status }}"
                                          data-toggle="m-tooltip"
                                          data-original-title="{{ account.get_status_display }}"></span>
                                    &nbsp;
                                    <i class="fa fa-flag" {% if not account.star_flag %}data-toggle="modal"
                                       data-target="#flag_account_modal"{% endif %}
                                       data-flag="{% if account.star_flag %}1{% else %}0{% endif %}"
                                       {% if account.star_flag %}style="color:#ff5733;"{% endif %}></i>
                                    &nbsp;
                                    <a href="/clients/accounts/{{ account.id }}/edit" style="color: #000;">
                  <span class="la la-edit">
                  </span>
                                    </a>
                                    <a class="btn btn-info m-btn btn-sm" href="/clients/accounts/{{ account.id }}/lifecycle">
                                      Lifecycle
                                    </a>
                                </h3>
                            </div>
                        </div>
                        <div class="m-portlet__head-tools">
                            <ul class="m-portlet__nav">
                                <li class="m-portlet__nav-item">
                                    <button type="button" class="btn btn-info m-btn"
                                            data-toggle="modal"
                                            data-target="#m_assign_members"> Assign Members
                                    </button>
                                    <button type="button" class="btn btn-info m-btn"
                                            data-toggle="modal"
                                            data-target="#m_position_allocation"> Assign %
                                    </button>
                                </li>
                            </ul>
                        </div>
                    </div>
                    <!-- Assigned members -->
                    <div class="m-portlet__body" style="padding: 1.2rem 1.2rem;">
                        <div class="row">
                            <div class="col-xl-12">
                                {% for role, assigned_member in account.assigned_ams.items %}
                                    <div class="m-card-profile">
                                        <div class="m-card-profile__pic">
                                            <div class="m-card-profile__pic-wrapper">
                                                {% if assigned_member.member.image != None %}
                                                    <img src="{% static 'img/bloomers/'|add:assigned_member.member.image %}"/>
                                                {% else %}
                                                    <img src="{% static 'assets/app/media/img/user4.jpg' %}" alt=""/>
                                                {% endif %}
                                            </div>
                                        </div>
                                        <div class="m-card-profile__details">
                                            <h3 class="m-portlet__head-text" style="font-size: 1.3rem;">
                                                {% if request.user.is_staff %}
                                                    <a href="/user_management/members/{{ assigned_member.member.id }}">{% endif %}{{ assigned_member.member.user.get_full_name }}
                                                {% if request.user.is_staff %}</a>{% endif %}</h3>
                                            <span class="m-badge  m-badge--info m-badge--wide">{{ role }}</span>
                                            <br/>
                                            <span data-toggle="m-tooltip"
                                                  data-original-title="{{ assigned_member.allocated_percentage }}%">{{ assigned_member.member|get_hours_per_member_and_account:account.id }}hr / {{ account|get_allocation_this_month_member:assigned_member.member }}hr</span>
                                        </div>
                                    </div>
                                {% endfor %}
                                {% for role, assigned_member in account.assigned_cms.items %}
                                    <div class="m-card-profile">
                                        <div class="m-card-profile__pic">
                                            <div class="m-card-profile__pic-wrapper">
                                                {% if assigned_member.member.image != None %}
                                                    <img src="{% static 'img/bloomers/'|add:assigned_member.member.image %}"/>
                                                {% else %}
                                                    <img src="{% static 'assets/app/media/img/user4.jpg' %}" alt=""/>
                                                {% endif %}
                                            </div>
                                        </div>
                                        <div class="m-card-profile__details">
                                            <h3 class="m-portlet__head-text" style="font-size: 1.3rem;">
                                                {% if request.user.is_staff %}
                                                    <a href="/user_management/members/{{ assigned_member.member.id }}">{% endif %}{{ assigned_member.member.user.get_full_name }}
                                                {% if request.user.is_staff %}</a>{% endif %}</h3>
                                            <span class="m-badge  m-badge--success m-badge--wide">{{ role }}</span>
                                            <br/>
                                            <span data-toggle="m-tooltip"
                                                  data-original-title="{{ assigned_member.allocated_percentage }}%">{{ assigned_member.member|get_hours_per_member_and_account:account.id }}hr / {{ account|get_allocation_this_month_member:assigned_member.member }}hr</span>
                                        </div>
                                    </div>
                                {% endfor %}
                                {% for role, assigned_member in account.assigned_seos.items %}
                                    <div class="m-card-profile">
                                        <div class="m-card-profile__pic">
                                            <div class="m-card-profile__pic-wrapper">
                                                {% if assigned_member.member.image != None %}
                                                    <img src="{% static 'img/bloomers/'|add:assigned_member.member.image %}"/>
                                                {% else %}
                                                    <img src="{% static 'assets/app/media/img/user4.jpg' %}" alt=""/>
                                                {% endif %}
                                            </div>
                                        </div>
                                        <div class="m-card-profile__details">
                                            <h3 class="m-portlet__head-text" style="font-size: 1.3rem;">
                                                {% if request.user.is_staff %}
                                                    <a href="/user_management/members/{{ assigned_member.member.id }}">{% endif %}{{ assigned_member.member.user.get_full_name }}
                                                {% if request.user.is_staff %}</a>{% endif %}</h3>
                                            <span class="m-badge  m-badge--warning m-badge--wide">{{ role }}</span>
                                            <br/>
                                            <span data-toggle="m-tooltip"
                                                  data-original-title="{{ assigned_member.allocated_percentage }}%">{{ assigned_member.member|get_hours_per_member_and_account:account.id }}hr / {{ account|get_allocation_this_month_member:assigned_member.member }}hr</span>
                                        </div>
                                    </div>
                                {% endfor %}
                                {% for role, assigned_member in account.assigned_strats.items %}
                                    <div class="m-card-profile">
                                        <div class="m-card-profile__pic">
                                            <div class="m-card-profile__pic-wrapper">
                                                {% if assigned_member.member.image != None %}
                                                    <img src="{% static 'img/bloomers/'|add:assigned_member.member.image %}"/>
                                                {% else %}
                                                    <img src="{% static 'assets/app/media/img/user4.jpg' %}" alt=""/>
                                                {% endif %}
                                            </div>
                                        </div>
                                        <div class="m-card-profile__details">
                                            <h3 class="m-portlet__head-text" style="font-size: 1.3rem;">
                                                {% if request.user.is_staff %}
                                                    <a href="/user_management/members/{{ assigned_member.member.id }}">{% endif %}{{ assigned_member.member.user.get_full_name }}
                                                {% if request.user.is_staff %}</a>{% endif %}</h3>
                                            <span class="m-badge  m-badge--danger m-badge--wide">{{ role }}</span>
                                            <br/>
                                            <span data-toggle="m-tooltip"
                                                  data-original-title="{{ assigned_member.allocated_percentage }}%">{{ assigned_member.member|get_hours_per_member_and_account:account.id }}hr / {{ account|get_allocation_this_month_member:assigned_member.member }}hr</span>
                                        </div>
                                    </div>
                                {% endfor %}
                                {% for backup in backups %}
                                    <div class="m-card-profile">
                                        <div class="m-card-profile__pic">
                                            <div class="m-card-profile__pic-wrapper">
                                                {% if backup.member.image != None %}
                                                    <img src="{% static 'img/bloomers/'|add:backup.member.image %}"/>
                                                {% else %}
                                                    <img src="{% static 'assets/app/media/img/user4.jpg' %}" alt=""/>
                                                {% endif %}
                                            </div>
                                        </div>
                                        <div class="m-card-profile__details">
                                            <h3 class="m-portlet__head-text" style="font-size: 1.3rem;">
                                                {% if request.user.is_staff %}
                                                    <a href="/user_management/members/{{ backup.member.id }}">{% endif %}{{ backup.member.user.get_full_name }}
                                                {% if request.user.is_staff %}</a>{% endif %}</h3>
                                            <span class="m-badge m-badge--wide"
                                                  style="background: #AA43DE; color: white;">Backup</span>
                                            <br/>
                                            <span data-toggle="m-tooltip">{{ backup.period.start_date }} - {{ backup.period.end_date }}</span>
                                        </div>
                                    </div>
                                {% endfor %}
                                {% if account.team_lead_override != None and account.team_lead_override != '' %}
                                    <div class="m-card-profile">
                                            <div class="m-card-profile__pic">
                                                <div class="m-card-profile__pic-wrapper">
                                                    {% if account.team_lead_override.image != None %}
                                                        <img src="{% static 'img/bloomers/'|add:account.team_lead_override.image %}"/>
                                                    {% else %}
                                                        <img src="{% static 'assets/app/media/img/user4.jpg' %}" alt=""/>
                                                    {% endif %}
                                                </div>
                                            </div>
                                            <div class="m-card-profile__details">
                                                <h3 class="m-portlet__head-text" style="font-size: 1.3rem;">
                                                    {% if request.user.is_staff %}
                                                        <a href="/user_management/members/{{ account.team_lead_override.id }}">{% endif %}{{ account.team_lead_override.user.get_full_name }}
                                                    {% if request.user.is_staff %}</a>{% endif %}</h3>
                                                <span class="m-badge m-badge--wide"
                                                      style="background: rgb(255, 153, 51); color: white;">Team Lead</span>
                                            </div>
                                        </div>
                                {% else %}
                                    {% for assigned_member in account.team_leads %}
                                        <div class="m-card-profile">
                                            <div class="m-card-profile__pic">
                                                <div class="m-card-profile__pic-wrapper">
                                                    {% if assigned_member.image != None %}
                                                        <img src="{% static 'img/bloomers/'|add:assigned_member.image %}"/>
                                                    {% else %}
                                                        <img src="{% static 'assets/app/media/img/user4.jpg' %}" alt=""/>
                                                    {% endif %}
                                                </div>
                                            </div>
                                            <div class="m-card-profile__details">
                                                <h3 class="m-portlet__head-text" style="font-size: 1.3rem;">
                                                    {% if request.user.is_staff %}
                                                        <a href="/user_management/members/{{ assigned_member.member.id }}">{% endif %}{{ assigned_member.user.get_full_name }}
                                                    {% if request.user.is_staff %}</a>{% endif %}</h3>
                                                <span class="m-badge m-badge--wide"
                                                      style="background: rgb(255, 153, 51); color: white;">Team Lead</span>
                                            </div>
                                        </div>
                                    {% endfor %}
                                {% endif %}
                                <div class="m-card-profile">
                                    <div class="m-card-profile__pic">
                                        <div class="m-card-profile__pic-wrapper">
                                            {% if account.soldBy.image != None %}
                                                <img src="{% static 'img/bloomers/'|add:account.soldBy.image %}"/>
                                            {% else %}
                                                <img src="{% static 'assets/app/media/img/user4.jpg' %}" alt=""/>
                                            {% endif %}
                                        </div>
                                    </div>
                                    <div class="m-card-profile__details">
                                        <h3 class="m-portlet__head-text" style="font-size: 1.3rem;">
                                            {% if request.user.is_staff %}
                                                <a href="/user_management/members/{{ account.soldBy.id }}">{% endif %}{{ account.soldBy.user.get_full_name }}
                                            {% if request.user.is_staff %}</a>{% endif %}</h3>
                                        <span class="m-badge m-badge--wide"
                                              style="background: rgb(0, 153, 151); color: white;">Sales</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- End of assigned members -->
                </div>
            </div>
            <div class="col-xl-4">
                <!-- KPI -->
                <div class="m-portlet m-portlet--mobile m-portlet--body-progress-">
                    <div class="m-portlet__head">
                        <div class="m-portlet__head-caption">
                            <div class="m-portlet__head-title">
                                <h3 class="m-portlet__head-text" style="font-size: 1.3rem;">
                                    KPIs
                                </h3>
                            </div>
                        </div>
                        <div class="m-portlet__head-tools">
                            <ul class="m-portlet__nav">
                                <li class="m-portlet__nav-item">
                                    <button type="button" class="btn btn-info m-btn"
                                            data-toggle="modal"
                                            data-target="#m_set_kpis" id="kpi_btn">
                                        Set KPIs
                                    </button>
                                </li>
                            </ul>
                        </div>
                    </div>
                    <div class="m-portlet__body">
                        <div class="form-group m-form__group">
                            <div class="row">
                                <div class="col-md-12 col-lg-12 col-xl-6">
                                    {% if account.target_roas != None and account.target_roas != 0.0 %}
                                        <div class="m-widget1__item">
                                            <div class="row m-row--no-padding align-items-center">
                                                <div class="col">
                                                    <h3 class="m-widget1__title">ROAS</h3>
                                                    <span class="m-widget1__desc">Target ROAS</span>
                                                </div>
                                                <div class="col m--align-right">
                                                    <span class="m-widget1__number m--font-brand">{{ account.roas_this_month|floatformat:2 }}</span>
                                                    <br/>
                                                    <span>{{ account.target_roas|floatformat:2 }}</span>
                                                </div>
                                            </div>
                                        </div>
                                        <hr/>
                                        <div class="m-widget1__item">
                                            <div class="row m-row--no-padding align-items-center">
                                                <div class="col">
                                                    <span class="m-widget1__title">Google Ads ROAS</span>
                                                    <span class="m-widget1__desc">Target ROAS</span>
                                                </div>
                                                <div class="col m--align-right">
                                                    <span class="m-widget1__number m--font-brand">{{ account.roas_this_month|floatformat:2 }}</span>
                                                    <br/>
                                                    <span>{{ account.target_roas|floatformat:2 }}</span>
                                                </div>
                                            </div>
                                        </div>
                                    {% else %}
                                        There is no target ROAS
                                    {% endif %}
                                </div>
                                <div class="col-md-12 col-lg-12 col-xl-6">
                                    {% if account.target_cpa != None and account.target_cpa != 0.0 %}
                                        <div class="m-widget1__item">
                                            <div class="row m-row--no-padding align-items-center">
                                                <div class="col">
                                                    <h3 class="m-widget1__title">CPA</h3>
                                                    <span class="m-widget1__desc">Target CPA</span>
                                                </div>
                                                <div class="col m--align-right">
                                                    <span class="m-widget1__number m--font-brand">${{ account.cpa_this_month|format_money }}</span>
                                                    <br/>
                                                    <span>${{ account.target_cpa|format_money }}</span>
                                                </div>
                                            </div>
                                        </div>
                                        <hr/>
                                        <div class="m-widget1__item">
                                            <div class="row m-row--no-padding align-items-center">
                                                <div class="col">
                                                    <span class="m-widget1__title">Google Ads CPA</span>
                                                    <span class="m-widget1__desc">Target CPA</span>
                                                </div>
                                                <div class="col m--align-right">
                                                    <span class="m-widget1__number m--font-brand">${{ account.google_kpi_month.cpa|format_money }}</span>
                                                    <br/>
                                                    <span>${{ account.target_cpa|format_money }}</span>
                                                </div>
                                            </div>
                                        </div>
                                    {% else %}
                                        There is no target CPA
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- End KPI -->
                <!-- Details -->
                <div class="m-portlet m-portlet--mobile m-portlet--body-progress-">
                    <div class="m-portlet__head">
                        <div class="m-portlet__head-caption">
                            <div class="m-portlet__head-title">
                                <h3 class="m-portlet__head-text" style="font-size: 1.3rem;">
                                    Details
                                </h3>
                            </div>
                        </div>
                    </div>
                    <div class="m-portlet__body">
                        <div class="form-group m-form__group">
                            <div class="row">
                                <div class="col-md-6">
                                    <label>Contact Name:</label>
                                    {% for clientContact in account.contactInfo.all %}
                                        <input type="text" class="form-control m-input" value="{{ clientContact.name }}"
                                               disabled>
                                    {% endfor %}
                                </div>
                                <div class="col-md-6">
                                    <label>Contact Email:</label>
                                    {% for clientContact in account.contactInfo.all %}
                                        <input type="text" class="form-control m-input"
                                               value="{{ clientContact.email }}" disabled>
                                    {% endfor %}
                                </div>
                            </div>
                        </div>
                        <div class="form-group m-form__group">
                            <div class="row">
                                <div class="col-md-6">
                                    <label>Contact Phone:</label>
                                    {% for clientContact in account.contactInfo.all %}
                                        <input type="text" class="form-control m-input"
                                               value="{{ clientContact.phone }}" disabled>
                                    {% endfor %}
                                </div>
                                <div class="col-md-6">
                                    <label for="role">Industry:</label>
                                    <input type="text" class="form-control m-input" value="{{ account.industry.name }}"
                                           disabled>
                                </div>
                            </div>
                        </div>
                        <div class="form-group m-form__group">
                            <div class="row">
                                <div class="col-md-6">
                                    <label for="team">Services:</label>
                                    {% if account.aw_budget != 0.0 %}
                                        <input type="text" class="form-control m-input" value="Adwords" disabled>
                                    {% endif %}
                                    {% if account.bing_budget != 0.0 %}
                                        <input type="text" class="form-control m-input" value="Bing" disabled>
                                    {% endif %}
                                    {% if account.fb_budget != 0.0 %}
                                        <input type="text" class="form-control m-input" value="Facebook" disabled>
                                    {% endif %}
                                    {% if account.has_seo %}
                                        <input type="text" class="form-control m-input" value="SEO" disabled>
                                    {% endif %}
                                    {% if account.has_cro %}
                                        <input type="text" class="form-control m-input" value="CRO" disabled>
                                    {% endif %}
                                </div>
                                <div class="col-md-6">
                                    <label for="team">Team:</label>
                                    {% for team in account.team.all %}
                                        <input type="text" class="form-control m-input" value="{{ team.name }}"
                                               disabled>
                                    {% endfor %}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- end details -->
                <!-- Hours this month -->
                <div class="m-portlet m-portlet--mobile m-portlet--body-progress-">
                    <div class="m-portlet__head">
                        <div class="m-portlet__head-caption">
                            <div class="m-portlet__head-title">
                                <h3 class="m-portlet__head-text" style="font-size: 1.3rem;">
                                    Hours This Month
                                </h3>
                            </div>
                        </div>
                    </div>
                    <div class="m-portlet__body">
                        <table class='table table-striped table-bordered table-hover table-checkable dataTable no-footer dtr-inline'
                               id="single_client_hours_datatable">
                            <thead>
                            <tr>
                                <th>
                                    Member
                                </th>
                                <th>
                                    Hours
                                </th>
                                <th>
                                    Month
                                </th>
                            </tr>
                            </thead>
                            <tbody>
                            {% for hourRow in accountHoursMember %}
                                <tr>
                                    <td>
                                        {{ hourRow.member }}
                                    </td>
                                    <td>
                                        {{ hourRow.hours__sum }}
                                    </td>
                                    <td>
                                        {{ hourRow.month }}
                                    </td>
                                </tr>
                            {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
                <!-- end hours this month -->

                <!-- Value added hours this month -->
                <div class="m-portlet m-portlet--mobile m-portlet--body-progress-">
                    <div class="m-portlet__head">
                        <div class="m-portlet__head-caption">
                            <div class="m-portlet__head-title">
                                <h3 class="m-portlet__head-text" style="font-size: 1.3rem;">
                                    Value Added Hours This Month
                                </h3>
                            </div>
                        </div>
                    </div>
                    <div class="m-portlet__body">
                        <table class='table table-striped table-bordered table-hover table-checkable dataTable no-footer dtr-inline'
                               id="single_client_hours_datatable">
                            <thead>
                            <tr>
                                <th>
                                    Member
                                </th>
                                <th>
                                    Hours
                                </th>
                                <th>
                                    Month
                                </th>
                            </tr>
                            </thead>
                            <tbody>
                            {% for hourRow in value_hours_member %}
                                <tr>
                                    <td>
                                        {{ hourRow.member }}
                                    </td>
                                    <td>
                                        {{ hourRow.hours__sum }}
                                    </td>
                                    <td>
                                        {{ hourRow.month }}
                                    </td>
                                </tr>
                            {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
                <!-- End value added hours -->

                <!-- Account history -->
{#                <div class="m-portlet m-portlet--mobile m-portlet--body-progress-">#}
{#                    <div class="m-portlet__head">#}
{#                        <div class="m-portlet__head-caption">#}
{#                            <div class="m-portlet__head-title">#}
{#                                <h3 class="m-portlet__head-text" style="font-size: 1.3rem;">#}
{#                                    Account History#}
{#                                </h3>#}
{#                            </div>#}
{#                        </div>#}
{#                    </div>#}
{#                    <div class="m-portlet__body">#}
{#                        <table class='table table-striped table-bordered table-hover table-checkable dataTable no-footer dtr-inline'#}
{#                               id="account_change_datatable">#}
{#                            <thead class="thead-inverse">#}
{#                            <tr class="main-table-header">#}
{#                                <th>#}
{#                                    Member#}
{#                                </th>#}
{#                                <th>#}
{#                                    Field Changed#}
{#                                </th>#}
{#                                <th>#}
{#                                    Changed From#}
{#                                </th>#}
{#                                <th>#}
{#                                    Changed To#}
{#                                </th>#}
{#                                <th>#}
{#                                    Date#}
{#                                </th>#}
{#                            </tr>#}
{#                            </thead>#}
{#                            <tbody>#}
{#                            {% for change in changes.all %}#}
{#                                <tr>#}
{#                                    <td>#}
{#                                        {{ change.member.user.first_name }} {{ change.member.user.last_name }}#}
{#                                    </td>#}
{#                                    <td>#}
{#                                        {{ change.changeField }}#}
{#                                    </td>#}
{#                                    <td>#}
{#                                        {{ change.changedFrom }}#}
{#                                    </td>#}
{#                                    <td>#}
{#                                        {{ change.changedTo }}#}
{#                                    </td>#}
{#                                    <td>#}
{#                                        {{ change.datetime }}#}
{#                                    </td>#}
{#                                </tr>#}
{#                            {% endfor %}#}
{#                            </tbody>#}
{#                        </table>#}
{#                    </div>#}
{#                </div>#}
                <!-- end account history -->

                <div class="m-portlet m-portlet--mobile m-portlet--body-progress-">
                    <div class="m-portlet__head">
                        <div class="m-portlet__head-caption">
                            <div class="m-portlet__head-title">
                                <h3 class="m-portlet__head-text" style="font-size: 1.3rem;">
                                    Services
                                </h3>
                            </div>
                        </div>
                        <div class="m-portlet__head-tools">
                            <ul class="m-portlet__nav">
                                <li class="m-portlet__nav-item">
                                    <button type="button" class="btn btn-info m-btn" data-toggle="modal" data-target="#m_update_services" id="kpi_btn">
                                        Update
                                    </button>
                                </li>
                            </ul>
                        </div>
                    </div>
                    <div class="m-portlet__body">
                        <table class='table table-striped table-bordered table-hover table-checkable dataTable no-footer dtr-inline'
                               id="account_change_datatable">
                            <thead class="thead-inverse">
                            <tr class="main-table-header">
                                <th>
                                    Service
                                </th>
                                <th>
                                    Status
                                </th>
                            </tr>
                            </thead>
                            <tbody>
                            <tr>
                                <td>
                                    PPC
                                </td>
                                <td>
                                    {{ account.sales_profile.get_ppc_status_display }}
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    SEO
                                </td>
                                <td>
                                    {{ account.sales_profile.get_seo_status_display }}
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    CRO
                                </td>
                                <td>
                                    {{ account.sales_profile.get_cro_status_display }}
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    Strat
                                </td>
                                <td>
                                    {{ account.sales_profile.get_strat_status_display }}
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    Email Marketing
                                </td>
                                <td>
                                    {{ account.sales_profile.get_email_status_display }}
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    Feed Management
                                </td>
                                <td>
                                    {{ account.sales_profile.get_feed_status_display }}
                                </td>
                            </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Management fee structure -->
                <div class="m-portlet m-portlet--mobile m-portlet--body-progress-">
                    <div class="m-portlet__head">
                        <div class="m-portlet__head-caption">
                            <div class="m-portlet__head-title">
                                <h3 class="m-portlet__head-text" style="font-size: 1.3rem;">
                                    Management Fee Structure
                                </h3>
                            </div>
                        </div>
                    </div>
                    <div class="m-portlet__body">
                        {% if account.management_fee_override != None and account.management_fee_override != 0.0 %}
                            <p>Manual Override: ${{ account.management_fee_override }}</p>
                        {% else %}
                            <table class='table table-striped table-bordered table-hover table-checkable dataTable no-footer dtr-inline'
                                   id="fee_structure_datatable">
                                <thead class="thead-inverse">
                                <tr class="main-table-header">
                                    <th>
                                        Monthly Media Spend
                                    </th>
                                    <th>
                                        Monthly Fee
                                    </th>
                                </tr>
                                </thead>
                                <tbody>
                                {% for interval in account.managementFee.feeStructure.all %}
                                    <tr>
                                        <td>
                                            ${{ interval.lowerBound }} - ${{ interval.upperBound }}
                                        </td>
                                        <td>
                                            {% if interval.feeStyle == 1 %}${{ interval.fee|format_money }}{% endif %}
                                            {% if interval.feeStyle == 0 %}{{ interval.fee }}%{% endif %}
                                        </td>
                                    </tr>
                                {% endfor %}
                                </tbody>
                            </table>
                        {% endif %}
                    </div>
                </div>
                <!-- end management fee structure -->
            </div>
            <div class="col-xl-8">
                <!-- Main portlet -->
                <div class="m-portlet m-portlet--mobile m-portlet--body-progress-">
                    <div class="m-portlet__head">
                        <div class="m-portlet__head-caption">
                            <div class="m-portlet__head-title">
                                <h3 class="m-portlet__head-text">
                                    Budget Information
                                </h3>
                            </div>
                        </div>
                        <div class="m-portlet__head-tools">
                            <ul class="m-portlet__nav">
                                <li class="m-portlet__nav-item">
                                    <a class="btn btn-info m-btn" href="/budget/client/{{ account.id }}">
                                        Manage Budget
                                    </a>
                                </li>
                            </ul>
                        </div>
                    </div>
                    <div class="m-portlet__body">
                        <div class="row m-row--no-padding m-row--col-separator-xl">
                            <div class="col-md-12 col-lg-12 col-xl-6">
                                <div class="m-widget1">
                                    <div class="m-widget1__item">
                                        <div class="row m-row--no-padding align-items-center">
                                            <div class="col">
                                                <h3 class="m-widget1__title">Total Budget</h3>
                                                <span class="m-widget1__desc">Total monthy budget</span>
                                            </div>
                                            <div class="col m--align-right">
                                                <span class="m-widget1__number m--font-brand">${{ account.current_budget|format_money }}</span>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="m-widget1__item">
                                        <div class="row m-row--no-padding align-items-center">
                                            <div class="col">
                                                <h3 class="m-widget1__title">Spend This Month</h3>
                                                <span class="m-widget1__desc">Amount spent (Adwords, FB, Bing)</span>
                                            </div>
                                            <div class="col m--align-right">
                                                <span class="m-widget1__number m--font-danger">${{ account.current_spend|format_money }}</span>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="m-widget1__item">
                                        <div class="row m-row--no-padding align-items-center">
                                            <div class="col">
                                                <h3 class="m-widget1__title">Budget Remaining</h3>
                                                <span class="m-widget1__desc">Left to spend this month</span>
                                            </div>
                                            <div class="col m--align-right">
                                                <span class="m-widget1__number m--font-success">${{ account.remainingBudget|format_money }}</span>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="m-widget1__item">
                                        <div class="row m-row--no-padding align-items-center">
                                            <div class="col">
                                                <h3 class="m-widget1__title">Management Fee</h3>
                                                <span class="m-widget1__desc">Projected management fee this month</span>
                                            </div>
                                            <div class="col m--align-right">
                                                <span class="m-widget1__number m--font-success">${{ account.total_fee|format_money }}</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-12 col-lg-12 col-xl-6">
                                <div class="m-widget1">
                                    <div class="m-widget1__item">
                                        <div class="row m-row--no-padding align-items-center">
                                            <div class="col">
                                                <h3 class="m-widget1__title">Allocated Hours This Month</h3>
                                                <span class="m-widget1__desc">All hours allocated this month</span>
                                            </div>
                                            <div class="col m--align-right">
                                                <span class="m-widget1__number m--font-info">{{ account.all_hours|floatformat }}</span>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="m-widget1__item">
                                        <div class="row m-row--no-padding align-items-center">
                                            <div class="col">
                                                <h3 class="m-widget1__title">Hours Worked This Month</h3>
                                                <span class="m-widget1__desc">All hours worked this month</span>
                                            </div>
                                            <div class="col m--align-right">
                                                <span class="m-widget1__number m--font-info">{{ account.hoursWorkedThisMonth|floatformat }}</span>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="m-widget1__item">
                                        <div class="row m-row--no-padding align-items-center">
                                            <div class="col">
                                                <h3 class="m-widget1__title">Hours Remaining This Month</h3>
                                                <span class="m-widget1__desc">All hours remaining this month</span>
                                            </div>
                                            <div class="col m--align-right">
                                                <span class="m-widget1__number m--font-{% if account.hoursRemainingMonth < 0 %}danger{% else %}info{% endif %}">{{ account.hoursRemainingMonth|floatformat }}</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- End main portlet -->
                <!-- Promos -->
                <div class="m-portlet m-portlet--mobile m-portlet--body-progress-">
                    <div class="m-portlet__head">
                        <div class="m-portlet__head-caption">
                            <div class="m-portlet__head-title">
                                <h3 class="m-portlet__head-text">
                                    Promos
                                </h3>
                            </div>
                        </div>
                        <div class="m-portlet__head-tools">
                            <ul class="m-portlet__nav">
                                <li class="m-portlet__nav-item">
                                    <button type="button" class="btn btn-info m-btn"
                                            data-toggle="modal"
                                            data-target="#m_new_promo"> Add Promos
                                    </button>
                                </li>
                                <li class="m-portlet__nav-item">
                                    <a class="btn btn-info m-btn" href="/clients/promos/edit">
                                        Edit Promos
                                    </a>
                                </li>
                            </ul>
                        </div>
                    </div>
                    <div class="m-portlet__body">
                        {% if promos.count > 0 %}
                            <div id="calendar" class="fc fc-unthemed fc-ltr">

                            </div>
                        {% endif %}
                    </div>
                </div>
                <!-- End promos -->
                {% if promos.count > 0 %}
                    <!-- Promo this month summary -->
                    <div class="m-portlet m-portlet--mobile m-portlet--body-progress-">
                        <div class="m-portlet__head">
                            <div class="m-portlet__head-caption">
                                <div class="m-portlet__head-title">
                                    <h3 class="m-portlet__head-text">
                                        Promo Summary
                                    </h3>
                                </div>
                            </div>
                        </div>
                        <div class="m-portlet__body">
                            <table class='table table-striped table-bordered table-hover table-checkable dataTable no-footer dtr-inline'
                                   id="account_change_datatable">
                                <thead class="thead-inverse">
                                <tr class="main-table-header">
                                    <th>
                                        Promo Name
                                    </th>
                                    <th>
                                        Start Date
                                    </th>
                                    <th>
                                        End Date
                                    </th>
                                    <th>
                                        Desc
                                    </th>
                                    <th>
                                        Services
                                    </th>
                                    <th>
                                        Confirmed Started
                                    </th>
                                    <th>
                                        Confirmed Ended
                                    </th>
                                </tr>
                                </thead>
                                <tbody>
                                {% for promo in promos %}
                                    <tr>
                                        <td>
                                            {{ promo }}
                                        </td>
                                        <td>
                                            {{ promo.start_date }}
                                        </td>
                                        <td>
                                            {{ promo.end_date }}
                                        </td>
                                        <td>
                                            {{ promo.desc }}
                                        </td>
                                        <td>
                                            {{ promo.services_str }}
                                        </td>
                                        <td>
                                            <input type="checkbox" class="confirm-promo" data-promo-id="{{ promo.id }}"
                                                   data-account-id="{{ account.id }}" data-confirmation-type="0"
                                                   {% if promo.confirmed_started != None %}checked disabled{% endif %}/>
                                        </td>
                                        <td>
                                            <input type="checkbox" class="confirm-promo" data-promo-id="{{ promo.id }}"
                                                   data-account-id="{{ account.id }}" data-confirmation-type="1"
                                                   {% if promo.confirmed_ended != None %}checked disabled{% endif %}/>
                                        </td>
                                    </tr>
                                {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    </div>
                    <!-- End promos this month summary -->
                {% endif %}
            </div>
            <!-- end assigned members -->
        </div>
        <!--End::Main Portlet-->
    </div>

    <!-- Begin assign members modal -->
    <div class="modal fade" id="m_assign_members" tabindex="-1" role="dialog" aria-labelledby="m_assign_members">
        <div class="modal-dialog modal-lg modal-dialog-centered" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Assign Members to {{ account.client_name }}</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true"></span>
                    </button>
                </div>
                <form class="m-form" method="POST" action="/clients/accounts/assign_members" id="m_form_assign_members">
                    {% csrf_token %}
                    <input name="account_id" type="text" value="{{ account.id }}" style="display:none;"/>
                    <div class="modal-body">
                        <div class="m-portlet__body">
                            <div class="form-group m-form__group">
                                <div class="row">
                                    <div class="col-md-3">
                                        <label>AM:</label>
                                        <select class="form-control m-input"
                                                name="am1-assign"
                                                style="width: 100%;">
                                            <option value="0">
                                                None
                                            </option>
                                            {% for member in members %}
                                                <option value="{{ member.id }}"
                                                        {% if member.id == account.am1.id %}selected{% endif %}>{{ member.user.first_name }} {{ member.user.last_name }}</option>
                                            {% endfor %}
                                        </select>
                                    </div>
                                    <div class="col-md-3">
                                        <label>AM2:</label>
                                        <select class="form-control m-input"
                                                name="am2-assign"
                                                style="width: 100%;">
                                            <option value="0">
                                                None
                                            </option>
                                            {% for member in members %}
                                                <option value="{{ member.id }}"
                                                        {% if member.id == account.am2.id %}selected{% endif %}>{{ member.user.first_name }} {{ member.user.last_name }}</option>
                                            {% endfor %}
                                        </select>
                                    </div>
                                    <div class="col-md-3">
                                        <label>AM3:</label>
                                        <select class="form-control m-input"
                                                name="am3-assign"
                                                style="width: 100%;">
                                            <option value="0">
                                                None
                                            </option>
                                            {% for member in members %}
                                                <option value="{{ member.id }}"
                                                        {% if member.id == account.am3.id %}selected{% endif %}>{{ member.user.first_name }} {{ member.user.last_name }}</option>
                                            {% endfor %}
                                        </select>
                                    </div>
                                </div>
                            </div>
                            <div class="form-group m-form__group">
                                <div class="row">
                                    <div class="col-md-3">
                                        <label for="buffer_total_percentage">CM:</label>
                                        <select class="form-control m-input"
                                                name="cm1-assign"
                                                style="width: 100%;">
                                            <option value="0">
                                                None
                                            </option>
                                            {% for member in members %}
                                                <option value="{{ member.id }}"
                                                        {% if member.id == account.cm1.id %}selected{% endif %}>{{ member.user.first_name }} {{ member.user.last_name }}</option>
                                            {% endfor %}
                                        </select>
                                    </div>
                                    <div class="col-md-3">
                                        <label for="buffer_learning_percentage">CM2:</label>
                                        <select class="form-control m-input"
                                                name="cm2-assign"
                                                style="width: 100%;">
                                            <option value="0">
                                                None
                                            </option>
                                            {% for member in members %}
                                                <option value="{{ member.id }}"
                                                        {% if member.id == account.cm2.id %}selected{% endif %}>{{ member.user.first_name }} {{ member.user.last_name }}</option>
                                            {% endfor %}
                                        </select>
                                    </div>
                                    <div class="col-md-3">
                                        <label for="buffer_trainers_percentage">CM3:</label>
                                        <select class="form-control m-input"
                                                name="cm3-assign"
                                                style="width: 100%;">
                                            <option value="0">
                                                None
                                            </option>
                                            {% for member in members %}
                                                <option value="{{ member.id }}"
                                                        {% if member.id == account.cm3.id %}selected{% endif %}>{{ member.user.first_name }} {{ member.user.last_name }}</option>
                                            {% endfor %}
                                        </select>
                                    </div>
                                </div>
                            </div>
                            <div class="form-group m-form__group">
                                <div class="row">
                                    <div class="col-md-3">
                                        <label>Strat:</label>
                                        <select class="form-control m-input"
                                                name="strat1-assign"
                                                style="width: 100%;">
                                            <option value="0">
                                                None
                                            </option>
                                            {% for member in members %}
                                                <option value="{{ member.id }}"
                                                        {% if member.id == account.strat1.id %}selected{% endif %}>{{ member.user.first_name }} {{ member.user.last_name }}</option>
                                            {% endfor %}
                                        </select>
                                    </div>
                                    <div class="col-md-3">
                                        <label>Strat 2:</label>
                                        <select class="form-control m-input"
                                                name="strat2-assign"
                                                style="width: 100%;">
                                            <option value="0">
                                                None
                                            </option>
                                            {% for member in members %}
                                                <option value="{{ member.id }}"
                                                        {% if member.id == account.strat2.id %}selected{% endif %}>{{ member.user.first_name }} {{ member.user.last_name }}</option>
                                            {% endfor %}
                                        </select>
                                    </div>
                                    <div class="col-md-3">
                                        <label>Strat 3:</label>
                                        <select class="form-control m-input"
                                                name="strat3-assign"
                                                style="width: 100%;">
                                            <option value="0">
                                                None
                                            </option>
                                            {% for member in members %}
                                                <option value="{{ member.id }}"
                                                        {% if member.id == account.strat3.id %}selected{% endif %}>{{ member.user.first_name }} {{ member.user.last_name }}</option>
                                            {% endfor %}
                                        </select>
                                    </div>
                                </div>
                            </div>
                            <div class="form-group m-form__group">
                                <div class="row">
                                    <div class="col-md-3">
                                        <label>SEO:</label>
                                        <select class="form-control m-input"
                                                name="seo1-assign"
                                                style="width: 100%;">
                                            <option value="0">
                                                None
                                            </option>
                                            {% for member in members %}
                                                <option value="{{ member.id }}"
                                                        {% if member.id == account.seo1.id %}selected{% endif %}>{{ member.user.first_name }} {{ member.user.last_name }}</option>
                                            {% endfor %}
                                        </select>
                                    </div>
                                    <div class="col-md-3">
                                        <label>SEO2:</label>
                                        <select class="form-control m-input"
                                                name="seo2-assign"
                                                style="width: 100%;">
                                            <option value="0">
                                                None
                                            </option>
                                            {% for member in members %}
                                                <option value="{{ member.id }}"
                                                        {% if member.id == account.seo2.id %}selected{% endif %}>{{ member.user.first_name }} {{ member.user.last_name }}</option>
                                            {% endfor %}
                                        </select>
                                    </div>
                                    <div class="col-md-3">
                                        <label>SEO3:</label>
                                        <select class="form-control m-input"
                                                name="seo3-assign"
                                                style="width: 100%;">
                                            <option value="0">
                                                None
                                            </option>
                                            {% for member in members %}
                                                <option value="{{ member.id }}"
                                                        {% if member.id == account.seo3.id %}selected{% endif %}>{{ member.user.first_name }} {{ member.user.last_name }}</option>
                                            {% endfor %}
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <input type="submit" value="Submit" class="btn btn-brand">
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    <!-- End member assignment modal -->

    <!-- Allocation per position modal -->
    <div class="modal fade" id="m_position_allocation" tabindex="-1" role="dialog"
         aria-labelledby="m_position_allocation">
        <div class="modal-dialog modal-lg modal-dialog-centered" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Percentages per position for {{ account.client_name }}</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true"></span>
                    </button>
                </div>
                <form class="m-form" method="POST" action="/clients/accounts/allocate_percentages"
                      id="m_form_allocate_percentages">
                    {% csrf_token %}
                    <input name="account_id" type="text" value="{{ account.id }}" style="display:none;"/>
                    <div class="modal-body">
                        <div class="m-portlet__body">
                            <div class="form-group m-form__group">
                                <div class="row">
                                    <div class="col-md-4">
                                        <label>AM:</label>
                                        <input type="text" name="am1-percent" id="am1-percent"
                                               class="form-control m-input" value="{{ account.am1percent }}"/>
                                    </div>
                                    <div class="col-md-4">
                                        <label>AM2:</label>
                                        <input type="text" name="am2-percent" id="am2-percent"
                                               class="form-control m-input" value="{{ account.am2percent }}"/>
                                    </div>
                                    <div class="col-md-4">
                                        <label>AM3:</label>
                                        <input type="text" name="am3-percent" id="am3-percent"
                                               class="form-control m-input" value="{{ account.am3percent }}"/>
                                    </div>
                                </div>
                            </div>
                            <div class="form-group m-form__group">
                                <div class="row">
                                    <div class="col-md-4">
                                        <label>CM:</label>
                                        <input type="text" name="cm1-percent" id="cm1-percent"
                                               class="form-control m-input" value="{{ account.cm1percent }}"/>
                                    </div>
                                    <div class="col-md-4">
                                        <label>CM2:</label>
                                        <input type="text" name="cm2-percent" id="cm2-percent"
                                               class="form-control m-input" value="{{ account.cm2percent }}"/>
                                    </div>
                                    <div class="col-md-4">
                                        <label>CM3:</label>
                                        <input type="text" name="cm3-percent" id="cm3-percent"
                                               class="form-control m-input" value="{{ account.cm3percent }}"/>
                                    </div>
                                </div>
                            </div>
                            <div class="form-group m-form__group">
                                <div class="row">
                                    <div class="col-md-4">
                                        <label>Strat:</label>
                                        <input type="text" name="strat1-percent" id="strat1-percent"
                                               class="form-control m-input" value="{{ account.strat1percent }}"/>
                                    </div>
                                    <div class="col-md-4">
                                        <label>Strat 2:</label>
                                        <input type="text" name="strat2-percent" id="strat2-percent"
                                               class="form-control m-input" value="{{ account.strat2percent }}"/>
                                    </div>
                                    <div class="col-md-4">
                                        <label>Strat 3:</label>
                                        <input type="text" name="strat3-percent" id="strat3-percent"
                                               class="form-control m-input" value="{{ account.strat3percent }}"/>
                                    </div>
                                </div>
                            </div>
                            <div class="form-group m-form__group">
                                <div class="row">
                                    <div class="col-md-4">
                                        <label>SEO:</label>
                                        <input type="text" name="seo1-percent" id="seo1-percent"
                                               class="form-control m-input" value="{{ account.seo1percent }}"/>
                                    </div>
                                    <div class="col-md-4">
                                        <label>SEO 2:</label>
                                        <input type="text" name="seo2-percent" id="seo2-percent"
                                               class="form-control m-input" value="{{ account.seo2percent }}"/>
                                    </div>
                                    <div class="col-md-4">
                                        <label>SEO 3:</label>
                                        <input type="text" name="seo3-percent" id="seo3-percent"
                                               class="form-control m-input" value="{{ account.seo3percent }}"/>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-success" id="distribute_hours_btn"
                                style="margin-right:auto;">Distribute hours proportionately
                        </button>
                        <input type="submit" value="Submit" class="btn btn-brand">
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    <!-- End assign percentages modal -->

    <!-- Add promo -->
    <div class="modal fade" id="m_new_promo" tabindex="-1" role="dialog" aria-labelledby="m_position_allocation">
        <div class="modal-dialog modal-lg modal-dialog-centered" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Add a promo</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true"></span>
                    </button>
                </div>
                <form class="m-form" method="POST" action="/clients/accounts/new_promo" id="m_form_new_promo">
                    {% csrf_token %}
                    <input name="account_id" type="text" value="{{ account.id }}" style="display:none;"/>
                    <div class="modal-body">
                        <div class="m-portlet__body">
                            <div class="form-group m-form__group">
                                <div class="row">
                                    <div class="col-md-4">
                                        <label>Name:</label>
                                        <input type="text" name="promo-name" class="form-control m-input"/>
                                    </div>
                                    <div class="col-md-4">
                                        <label>Start Date:</label>
                                        <input type="text" name="start-date" class="form-control datetimepicker"
                                               readonly="" placeholder="Set start date here">
                                    </div>
                                    <div class="col-md-4">
                                        <label>End Date:</label>
                                        <input type="text" name="end-date" class="form-control datetimepicker"
                                               readonly="" placeholder="Set end date here">
                                    </div>
                                </div>
                                <hr/>
                                <div class="row">
                                    <div class="col-md-6">
                                        <label>Description:</label>
                                        <input type="text" maxlength="140" name="promo-desc"
                                               class="form-control m-input"/>
                                    </div>
                                    <div class="col-md-1">
                                        <label>AW:</label>
                                        <input type="checkbox" name="has-aw" class="form-control"/>
                                    </div>
                                    <div class="col-md-1">
                                        <label>FB:</label>
                                        <input type="checkbox" name="has-fb" class="form-control"/>
                                    </div>
                                    <div class="col-md-1">
                                        <label>Bing:</label>
                                        <input type="checkbox" name="has-bing" class="form-control"/>
                                    </div>
                                    <div class="col-md-1">
                                        <label>Other:</label>
                                        <input type="checkbox" name="has-other" class="form-control"/>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <input type="submit" value="Add Promo" class="btn btn-brand">
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    <!-- End add promo -->

    <!-- Set KPI modal -->
    <div class="modal fade" id="m_set_kpis" tabindex="-1" role="dialog" aria-labelledby="m_position_allocation">
        <div class="modal-dialog modal-lg modal-dialog-centered" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Set KPIs for {{ account.client_name }}</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true"></span>
                    </button>
                </div>
                <form class="m-form" method="POST" action="/clients/accounts/set_kpis">
                    {% csrf_token %}
                    <input name="account_id" type="text" value="{{ account.id }}" style="display:none;"/>
                    <div class="modal-body">
                        <div class="m-portlet__body">
                            <div class="form-group m-form__group">
                                <div class="row">
                                    <div class="col-md-6">
                                        <label>Target ROAS:</label>
                                        <input type="text" name="set-roas" class="form-control m-input"
                                               value="{{ account.target_roas }}"/>
                                    </div>
                                    <div class="col-md-6">
                                        <label>Target CPA:</label>
                                        <input type="text" name="set-cpa" class="form-control m-input"
                                               value="{{ account.target_cpa }}"/>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <input type="submit" value="Set Targets" class="btn btn-brand">
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    <!-- End set KPIs -->

    <!-- Set Services modal -->
    <div class="modal fade" id="m_update_services" tabindex="-1" role="dialog" aria-labelledby="m_position_allocation">
        <div class="modal-dialog modal-lg modal-dialog-centered" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Update Services</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true"></span>
                    </button>
                </div>
                <form class="m-form" method="POST" action="/clients/accounts/set_services">
                    {% csrf_token %}
                    <div class="modal-body">
                        <div class="m-portlet__body">
                            <input name="account_id" type="text" value="{{ account.id }}" style="display:none;"/>
                            <div class="row justify-content-between">
                                <div class="col-4">
                                    PPC
                                </div>
                                <div class="col-6">
                                    <select class="form-control" name="set-ppc">
                                        <option value="0">Onboarding</option>
                                        <option value="1">Active</option>
                                        <option value="2">Inactive</option>
                                        <option value="3">Lost</option>
                                        <option value="4">Opportunity</option>
                                        <option value="5">Pitched</option>
                                        <option value="6">None</option>
                                    </select>
                                </div>
                            </div>
                             <div class="row justify-content-between">
                                <div class="col-4">
                                    SEO
                                </div>
                                <div class="col-6">
                                    <select class="form-control" name="set-seo">
                                        <option value="0">Onboarding</option>
                                        <option value="1">Active</option>
                                        <option value="2">Inactive</option>
                                        <option value="3">Lost</option>
                                        <option value="4">Opportunity</option>
                                        <option value="5">Pitched</option>
                                        <option value="6">None</option>
                                    </select>
                                </div>
                            </div>
                             <div class="row justify-content-between">
                                <div class="col-4">
                                    CRO
                                </div>
                                <div class="col-6">
                                    <select class="form-control" name="set-cro">
                                        <option value="0">Onboarding</option>
                                        <option value="1">Active</option>
                                        <option value="2">Inactive</option>
                                        <option value="3">Lost</option>
                                        <option value="4">Opportunity</option>
                                        <option value="5">Pitched</option>
                                        <option value="6">None</option>
                                    </select>
                                </div>
                            </div>
                             <div class="row justify-content-between">
                                <div class="col-4">
                                    Strat
                                </div>
                                <div class="col-6">
                                    <select class="form-control" name="set-strat">
                                        <option value="0">Onboarding</option>
                                        <option value="1">Active</option>
                                        <option value="2">Inactive</option>
                                        <option value="3">Lost</option>
                                        <option value="4">Opportunity</option>
                                        <option value="5">Pitched</option>
                                        <option value="6">None</option>
                                    </select>
                                </div>
                            </div>
                             <div class="row justify-content-between">
                                <div class="col-4">
                                    Email Marketing
                                </div>
                                <div class="col-6">
                                    <select class="form-control" name="set-email-marketing">
                                        <option value="0">Onboarding</option>
                                        <option value="1">Active</option>
                                        <option value="2">Inactive</option>
                                        <option value="3">Lost</option>
                                        <option value="4">Opportunity</option>
                                        <option value="5">Pitched</option>
                                        <option value="6">None</option>
                                    </select>
                                </div>
                            </div>
                             <div class="row justify-content-between">
                                <div class="col-4">
                                    Feed Management
                                </div>
                                <div class="col-6">
                                    <select class="form-control" name="set-feed-management">
                                        <option value="0">Onboarding</option>
                                        <option value="1">Active</option>
                                        <option value="2">Inactive</option>
                                        <option value="3">Lost</option>
                                        <option value="4">Opportunity</option>
                                        <option value="5">Pitched</option>
                                        <option value="6">None</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <input type="submit" value="Update Services" class="btn btn-brand">
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    <!-- End set Services -->

    <!-- Flag account -->
    <div class="modal fade" id="flag_account_modal" tabindex="-1" role="dialog" aria-labelledby="m_position_allocation">
        <div class="modal-dialog modal-lg modal-dialog-centered" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Flag Account {{ account.client_name }}</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true"></span>
                    </button>
                </div>
                <form class="m-form" method="POST" action="/clients/accounts/flag">
                    {% csrf_token %}
                    <input name="account_id" type="text" value="{{ account.id }}" style="display:none;"/>
                    <div class="modal-body">
                        <div class="m-portlet__body">
                            <div class="form-group m-form__group">
                                <div class="row">
                                    <div class="col-md-12">
                                        <label>Basecamp Link:</label>
                                        <input type="text" name="bc_link" class="form-control m-input" required/>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <input type="submit" value="Flag Account" class="btn btn-brand">
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    <!-- End Flag account modal -->

{% endblock %}

{% block extraJs %}
    <script>
        $(document).ready(function () {
            var $distrubteHoursBtn = $('#distribute_hours_btn');
            var $starIcon = $('.fa-flag');
            let $promoCheck = $('.confirm-promo');

            $promoCheck.click(function () {
                let confirmation_type = $(this).data('confirmation-type');
                let promo_type = $(this).data('promo-id');
                if ($(this).is(':checked')) {
                    $.ajax({
                        url: '/clients/promos/confirm',
                        data: {
                            'account_id': {{ account.id }},
                            'promo_id': promo_type,
                            'confirmation_type': confirmation_type
                        },
                        headers: {'X-CSRFToken': csrftoken},
                        type: 'POST',
                        success: function (data) {
                            console.log(data);
                            $(this).prop('disabled', 'disabled');
                        }
                    });
                }

            });

            /**
             * Calendar
             */
            $('#calendar').fullCalendar({
                header: {
                    left: "prev, next, today",
                    center: "title",
                    right: "month, listWeek"
                },
                aspectRatio: 2,
                defaultDate: moment(),
                defaultView: 'month',
                events: [
                    {% for promo in promos %}
                        {
                            title: "{{ promo.name }}",
                            description: "{{ promo.desc }}",
                            start: moment("{{ promo.formatted_start }}"),
                            end: moment("{{ promo.formatted_end }}"),
                            className: "{% if promo.is_active %}m-fc-event--success{% else %}m-fc-event--warning{% endif %}"
                        }{% if not forloop.last %},{% endif %}
                    {% endfor %}
                ]
            });

            // var starAccount = function (flagOn) {
            //   $.ajax({
            //       url: '/clients/accounts/flag',
            //       data: {
            //         'account_id': {{ account.id }},
            //         'star_flag': flagOn
            //       },
            //       headers: {'X-CSRFToken': csrftoken},
            //       type: 'POST',
            //       success: function (data) {
            //         console.log(data);
            //       }
            //   });
            // };

            // $starIcon.click(function () {
            //   if ($starIcon.data('flag') == '1') {
            //     // On, so turn it off
            //     starAccount(1);
            //     $starIcon.data('flag', '0')
            //     $starIcon.css('color', '');
            //   } else {
            //     // Off, so turn it on
            //     starAccount(0);
            //     $starIcon.data('flag', '1')
            //     $starIcon.css('color', '#ff5733');
            //   }
            // });

            $('.m_datepicker').datepicker({
                todayHighlight: !0,
                autoclose: !0,
                format: 'yyyy-mm-dd',
                orientation: "bottom left",
                templates: {
                    leftArrow: '<i class="la la-angle-left"></i>',
                    rightArrow: '<i class="la la-angle-right"></i>'
                }
            }).on('show.bs.modal', function (event) {
                event.stopPropagation();
            });

            $('.datetimepicker').datetimepicker();


            var distributeHours = function () {
                var hasSeo = {% if account.has_seo %}true{% else %}false{% endif %};
                var seoHours = {{ account.seo_hours|escapejs }};
                var hasCro = {% if account.has_cro %}true{% else %}false{% endif %};
                var croHours = {{ account.cro_hours|escapejs }};
                var totalHours = {{ account.all_hours|escapejs }};
                var ppc_hours = {{ account.ppc_hours|escapejs }};

                // Cms
                var cms = [];
                {% if account.cm1 != None %}cms.push(1);{% endif %}
                {% if account.cm2 != None %}cms.push(2);{% endif %}
                {% if account.cm3 != None %}cms.push(3);{% endif %}
                // Ams
                var ams = [];
                {% if account.am1 != None %}ams.push(1);{% endif %}
                {% if account.am2 != None %}ams.push(2);{% endif %}
                {% if account.am3 != None %}ams.push(3);{% endif %}
                // strats
                var strats = [];
                {% if account.strat1 != None %}strats.push(1);{% endif %}
                {% if account.strat2 != None %}strats.push(2);{% endif %}
                {% if account.strat3 != None %}strats.push(3);{% endif %}
                // seos
                var seos = [];
                {% if account.seo1 != None %}seos.push(1);{% endif %}
                {% if account.seo2 != None %}seos.push(2);{% endif %}
                {% if account.seo3 != None %}seos.push(3);{% endif %}

                /**
                 * Calculate hour percentages
                 */
                var cmPortion = 0.75;
                var amPortion = 0.25;
                var seoPortion = 0.0;

                if (hasSeo || hasCro) {
                    var seoTotalPortion = ((seoHours + croHours) / totalHours);
                    seoPortion = seoTotalPortion * 0.9;
                    var remainingPortion = 1.0 - seoTotalPortion;
                    cmPortion = remainingPortion * 0.75;
                    amPortion = (remainingPortion * 0.25) + (seoPortion * 0.1);
                }

                var eachCm = (100.0 * cmPortion / cms.length).toFixed(2);
                var eachAm = (100.0 * amPortion / ams.length).toFixed(2);
                var eachSeo = (100.0 * seoPortion / seos.length).toFixed(2);

                /**
                 * First set all to 0
                 */
                for (var i = 1; i <= 3; i++) {
                    document.getElementById('cm' + i + '-percent').value = '0.0';
                    document.getElementById('am' + i + '-percent').value = '0.0';
                    document.getElementById('strat' + i + '-percent').value = '0.0';
                    document.getElementById('seo' + i + '-percent').value = '0.0';
                }

                cms.forEach(function (i) {
                    var el = document.getElementById('cm' + i + '-percent').value = eachCm;
                });

                ams.forEach(function (i) {
                    var el = document.getElementById('am' + i + '-percent').value = eachAm;
                });

                seos.forEach(function (i) {
                    var el = document.getElementById('seo' + i + '-percent').value = eachSeo;
                });

            };

            $distrubteHoursBtn.click(distributeHours);
        });
    </script>
{% endblock %}
